<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>–ü–æ–π–º–∞–π —Ü–≤–µ—Ç–æ—á–µ–∫</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    html, body {
      margin: 0;
      padding: 0;
      background: #000;
      color: #fff;
      font-family: Arial, sans-serif;
      overflow: hidden;
    }
    #scoreboard {
      position: absolute;
      top: 10px;
      left: 10px;
      z-index: 10;
      font-size: 24px;
      background: rgba(0, 0, 0, 0.7);
      padding: 5px 10px;
      border-radius: 8px;
    }
    canvas {
      display: block;
    }
  </style>
</head>
<body>
  <div id="scoreboard">–°—á—ë—Ç: 0 | –ü—Ä–æ–º–∞—Ö–æ–≤: 0</div>
  <canvas id="gameCanvas"></canvas>
  <script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const scoreboard = document.getElementById('scoreboard');

    // –ü–æ–¥–≥–æ–Ω—è–µ–º –∫–∞–Ω–≤–∞—Å –ø–æ–¥ —Ä–∞–∑–º–µ—Ä —ç–∫—Ä–∞–Ω–∞
    function resizeCanvas() {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
    }
    window.addEventListener('resize', resizeCanvas);
    resizeCanvas();

    // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–≥—Ä—ã
    let score = 0;
    let misses = 0;
    let gameOver = false;
    const emojis = [];
    const emojiSize = 50; // –î–∏–∞–º–µ—Ç—Ä —ç–º–æ–¥–∑–∏ (–±—É–¥–µ–º —Å—á–∏—Ç–∞—Ç—å, —á—Ç–æ –∏–∫–æ–Ω–∫–∞ –≤–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –≤ –∫—Ä—É–≥)
    // –î–æ–ø—É—Å–∫–∏ –¥–ª—è —Ö–∏—Ç–±–æ–∫—Å–æ–≤: –¥–ª—è —Ü–≤–µ—Ç–∫–∞ ‚Äî –±–æ–ª—å—à–µ, –¥–ª—è –æ—Å—Ç–∞–ª—å–Ω—ã—Ö ‚Äî –º–µ–Ω—å—à–µ
    const flowerExtraMargin = 30;
    const normalExtraMargin = 10;

    // –ú–∞—Å—Å–∏–≤ —Å–ª—É—á–∞–π–Ω—ã—Ö —ç–º–æ–¥–∑–∏ –¥–ª—è –Ω–µ—Ü–≤–µ—Ç–æ—á–∫–æ–≤
    const randomEmojis = ['üòÄ','üòÇ','üòç','üòé','ü§ñ','üçé','üçî','‚öΩ','üéà','üöó','üåü','üçÄ'];

    // –§—É–Ω–∫—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–≥–æ —ç–º–æ–¥–∑–∏ —Å –≤–æ–ª–Ω–æ–æ–±—Ä–∞–∑–Ω–æ–π —Ç—Ä–∞–µ–∫—Ç–æ—Ä–∏–µ–π (–∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã —Ü–µ–Ω—Ç—Ä–∞)
    function spawnEmoji() {
      // –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –ø–æ—è–≤–ª–µ–Ω–∏—è —Ü–≤–µ—Ç–æ—á–∫–∞ ‚Äì 30%
      const isFlower = Math.random() < 0.3;
      const char = isFlower ? 'üå∏' : randomEmojis[Math.floor(Math.random() * randomEmojis.length)];
      // –í—ã–±–∏—Ä–∞–µ–º –±–∞–∑–æ–≤—É—é –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—É x —Ç–∞–∫, —á—Ç–æ–±—ã —ç–º–æ–¥–∑–∏ –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–æ–º–µ—â–∞–ª—Å—è:
      const baseX = emojiSize/2 + Math.random() * (canvas.width - emojiSize);
      const amplitude = 30 + Math.random() * 20;  // –ê–º–ø–ª–∏—Ç—É–¥–∞ –≤–æ–ª–Ω—ã
      const period = 100 + Math.random() * 100;     // –ü–µ—Ä–∏–æ–¥ –≤–æ–ª–Ω—ã
      const speed = 2 + Math.random() * 3;
      // –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞ y –∑–∞–¥–∞—ë–º —Ç–∞–∫, —á—Ç–æ–±—ã —ç–º–æ–¥–∑–∏ –Ω–∞—á–∏–Ω–∞–ª –∑–∞ —ç–∫—Ä–∞–Ω–æ–º (–≤–≤–µ—Ä—Ö—É)
      emojis.push({
        baseX: baseX,
        x: baseX,
        y: -emojiSize/2,
        amplitude: amplitude,
        period: period,
        speed: speed,
        isFlower: isFlower,
        char: char
      });
    }

    // –§—É–Ω–∫—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–æ–ø–∞–¥–∞–Ω–∏—è –ø–æ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º –∫–ª–∏–∫–∞/—Ç–∞—á–∞
    function handleHit(clickX, clickY) {
      let hit = false;
      for (let i = emojis.length - 1; i >= 0; i--) {
        const emoji = emojis[i];
        // –û–±–Ω–æ–≤–ª—è–µ–º x —Å–æ–≥–ª–∞—Å–Ω–æ –≤–æ–ª–Ω–æ–æ–±—Ä–∞–∑–Ω–æ–º—É –¥–≤–∏–∂–µ–Ω–∏—é
        emoji.x = emoji.baseX + emoji.amplitude * Math.sin(emoji.y / emoji.period);
        // –¶–µ–Ω—Ç—Ä —ç–º–æ–¥–∑–∏ —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å (emoji.x, emoji.y) –±–ª–∞–≥–æ–¥–∞—Ä—è —Ü–µ–Ω—Ç—Ä–æ–≤–∫–µ —Ç–µ–∫—Å—Ç–∞
        const centerX = emoji.x;
        const centerY = emoji.y;
        // –í—ã–±–∏—Ä–∞–µ–º –¥–æ–ø—É—Å–∫: –¥–ª—è —Ü–≤–µ—Ç–∫–∞ ‚Äî –±–æ–ª—å—à–µ
        const extraMargin = emoji.isFlower ? flowerExtraMargin : normalExtraMargin;
        const hitRadius = emojiSize/2 + extraMargin;
        const distance = Math.hypot(clickX - centerX, clickY - centerY);
        if (distance <= hitRadius) {
          hit = true;
          if (emoji.isFlower) {
            score++;
          } else {
            misses++;
          }
          emojis.splice(i, 1);
          break;
        }
      }
      if (!hit) {
        misses++;
      }
      updateScoreboard();
      checkGameOver();
    }

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–ª–∏–∫–æ–≤ –º—ã—à—å—é
    canvas.addEventListener('click', function(e) {
      if (gameOver) return;
      const rect = canvas.getBoundingClientRect();
      const clickX = e.clientX - rect.left;
      const clickY = e.clientY - rect.top;
      handleHit(clickX, clickY);
    });

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è —Ç–∞—á-—Å–æ–±—ã—Ç–∏–π (—Å–º–∞—Ä—Ç—Ñ–æ–Ω—ã)
    canvas.addEventListener('touchstart', function(e) {
      if (gameOver) return;
      // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º –≤—Å–ø–ª—ã—Ç–∏–µ –∏ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ
      e.preventDefault();
      const rect = canvas.getBoundingClientRect();
      const touch = e.changedTouches[0];
      const clickX = touch.clientX - rect.left;
      const clickY = touch.clientY - rect.top;
      handleHit(clickX, clickY);
    });

    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–∞–±–ª–æ
    function updateScoreboard() {
      scoreboard.innerText = `–°—á—ë—Ç: ${score} | –ü—Ä–æ–º–∞—Ö–æ–≤: ${misses}`;
    }

    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∏–≥—Ä—ã
    function checkGameOver() {
      if (misses >= 3) {
        gameOver = true;
        setTimeout(() => {
          alert("–ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞! –í–∞—à —Å—á—ë—Ç: " + score);
          resetGame();
        }, 10);
      }
    }

    // –°–±—Ä–æ—Å –∏–≥—Ä—ã
    function resetGame() {
      score = 0;
      misses = 0;
      emojis.length = 0;
      gameOver = false;
      updateScoreboard();
    }

    // –û—Å–Ω–æ–≤–Ω–æ–π —Ü–∏–∫–ª –∏–≥—Ä—ã
    function update() {
      if (!gameOver && Math.random() < 0.03) {
        spawnEmoji();
      }
      
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      // –†–∏—Å—É–µ–º —ç–º–æ–¥–∑–∏ –ø–æ —Ü–µ–Ω—Ç—Ä—É: —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏—è –ø–æ —Ü–µ–Ω—Ç—Ä—É –∏ –ø–æ —Å–µ—Ä–µ–¥–∏–Ω–µ
      ctx.font = emojiSize + "px serif";
      ctx.textAlign = "center";
      ctx.textBaseline = "middle";

      // –†–∏—Å—É–µ–º –∏ –æ–±–Ω–æ–≤–ª—è–µ–º —ç–º–æ–¥–∑–∏
      for (let i = emojis.length - 1; i >= 0; i--) {
        const emoji = emojis[i];
        emoji.x = emoji.baseX + emoji.amplitude * Math.sin(emoji.y / emoji.period);
        emoji.y += emoji.speed;
        ctx.fillText(emoji.char, emoji.x, emoji.y);
        // –ï—Å–ª–∏ —ç–º–æ–¥–∑–∏ —É—à—ë–ª –∑–∞ –Ω–∏–∂–Ω—é—é –≥—Ä–∞–Ω–∏—Ü—É (—É—á–∏—Ç—ã–≤–∞–µ–º –µ–≥–æ —Ä–∞–¥–∏—É—Å)
        if (emoji.y - emojiSize/2 > canvas.height) {
          if (emoji.isFlower) {
            misses++;
          }
          emojis.splice(i, 1);
          updateScoreboard();
          checkGameOver();
        }
      }
      
      requestAnimationFrame(update);
    }

    update();
  </script>
</body>
</html>
